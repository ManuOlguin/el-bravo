datasource db {
  provider = "mysql"
}

generator client {
  provider = "prisma-client-js"
}

////////////////////
// ENUMS
////////////////////

enum GroupRole {
  admin
  member
}

enum SeasonStatus {
  waiting
  active
  finished
}

enum ActivityType {
  gym
  run
  sport
  mobility
  other
}

////////////////////
// MODELS
////////////////////

model User {
  id               String   @id @default(cuid())
  email            String   @unique
  passwordHash     String
  name             String?
  photoUrl         String?  @db.VarChar(2048)

  emailVerifiedAt  DateTime?
  isActive         Boolean  @default(true)

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  groupMembers     GroupMember[]
  seasonMembers    SeasonMember[]
  activities       Activity[]
}

model Group {
  id        String   @id @default(cuid())
  name      String
  photoUrl  String?  @db.VarChar(2048) // foto del grupo (URL)
  createdBy String
  createdAt DateTime @default(now())

  // Relations
  members GroupMember[]
  seasons Season[]
}

model GroupMember {
  id        String    @id @default(cuid())
  groupId   String
  userId    String
  role      GroupRole
  joinedAt  DateTime  @default(now())
  leftAt    DateTime?

  // Relations
  group Group @relation(fields: [groupId], references: [id])
  user  User  @relation(fields: [userId], references: [id])

  @@unique([groupId, userId])
}

model Season {
  id          String       @id @default(cuid())
  groupId     String
  name        String
  description String?      @db.Text
  startDate   DateTime
  endDate     DateTime
  status      SeasonStatus
  createdAt   DateTime     @default(now())

  // Relations
  group   Group          @relation(fields: [groupId], references: [id])
  members SeasonMember[]
}

model SeasonMember {
  id        String   @id @default(cuid())
  seasonId  String
  userId    String
  joinedAt  DateTime @default(now())
  leftAt    DateTime?

  // Relations
  season Season @relation(fields: [seasonId], references: [id])
  user   User   @relation(fields: [userId], references: [id])

  @@unique([seasonId, userId])
}

model Activity {
  id        String        @id @default(cuid())
  userId    String
  type      ActivityType
  startedAt DateTime
  endedAt   DateTime
  notes     String?       @db.Text
  createdAt DateTime      @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId, startedAt])
  @@index([startedAt])
}
